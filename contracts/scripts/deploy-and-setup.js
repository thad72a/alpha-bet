const hre = require("hardhat");
const fs = require("fs");
const path = require("path");

async function main() {
  console.log("ğŸš€ Starting deployment...\n");

  // Deploy a mock TAO token for testing
  console.log("ğŸ“ Deploying MockTAO token...");
  const MockTAO = await hre.ethers.getContractFactory("MockTAO");
  const mockTAO = await MockTAO.deploy();
  await mockTAO.waitForDeployment();
  
  const mockTAOAddress = await mockTAO.getAddress();
  console.log("âœ… MockTAO deployed to:", mockTAOAddress);

  // Deploy the BettingCard contract
  console.log("\nğŸ“ Deploying BettingCard contract...");
  const BettingCard = await hre.ethers.getContractFactory("BettingCard");
  const bettingCard = await BettingCard.deploy(mockTAOAddress);
  await bettingCard.waitForDeployment();

  const bettingCardAddress = await bettingCard.getAddress();
  console.log("âœ… BettingCard deployed to:", bettingCardAddress);
  
  // Create .env.local file
  console.log("\nğŸ“ Creating .env.local file...");
  const envContent = `# Auto-generated by deploy script - ${new Date().toISOString()}

# Smart Contract Addresses (Hardhat Local Network)
NEXT_PUBLIC_BETTING_CONTRACT_ADDRESS=${bettingCardAddress}
NEXT_PUBLIC_TAO_CONTRACT_ADDRESS=${mockTAOAddress}

# Network Configuration
NEXT_PUBLIC_RPC_URL=http://127.0.0.1:8545

# WalletConnect Project ID (optional - get from https://cloud.walletconnect.com/)
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=your_project_id_here
`;

  const envPath = path.join(__dirname, '../../.env.local');
  fs.writeFileSync(envPath, envContent);
  console.log("âœ… .env.local file created!");
  
  // Log the deployment info
  console.log("\n" + "=".repeat(50));
  console.log("ğŸ‰ DEPLOYMENT SUCCESSFUL!");
  console.log("=".repeat(50));
  console.log("Network:", hre.network.name);
  console.log("MockTAO Token:", mockTAOAddress);
  console.log("BettingCard Contract:", bettingCardAddress);
  console.log("\nâš ï¸  IMPORTANT:");
  console.log("1. Keep your Hardhat node running");
  console.log("2. Restart your Next.js dev server to pick up .env.local");
  console.log("3. Connect MetaMask to localhost:8545");
  console.log("4. Import Hardhat test account into MetaMask");
  console.log("=".repeat(50) + "\n");
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error("âŒ Deployment failed:", error);
    process.exit(1);
  });

